<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure | KAY SINGH</title>
<meta name="keywords" content="Azure, Azure Functions, Azure Logic Apps, Azure Video Indexer, Azure File Share, Azure Storage, Serverless, AV1, H.265, H.264, x264, Video Codec, Video Encoding" />
<meta name="description" content="This is a 3-part blog covering how to build a scalable shot-based serverless video encoder in Azure. In Part 1, I explain what AV1 is and where we are in the video encoding space. In part 2, we create a logic app to upload and index the video. In part 3, we&rsquo;ll need to split the video into its scenes and encode individual scenes. For reference, here are the links to all the parts:">
<meta name="author" content="Kay Singh">
<link rel="canonical" href="https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/" />
<link href="/assets/css/stylesheet.min.008046a736ca917e1b698ee5423c620b52157fe427092ea7d1103ea41befdf2c.css" integrity="sha256-AIBGpzbKkX4baY7lQjxiC1IVf&#43;QnCS6n0RA&#43;pBvv3yw=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://singhkays.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://singhkays.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://singhkays.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://singhkays.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://singhkays.com/android-chrome-512x512.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.83.1" />


<script type="text/javascript">
  window._mNHandle = window._mNHandle || {};
  window._mNHandle.queue = window._mNHandle.queue || [];
  medianet_versionId = "3121199";
</script>
<script src="//contextual.media.net/dmedianet.js?cid=8CUX6J71X" async="async"></script>

<script data-ad-client="ca-pub-8046835310934475" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-JDVREY790Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JDVREY790Z');
</script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-108462543-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure" />
<meta property="og:description" content="This is a 3-part blog covering how to build a scalable shot-based serverless video encoder in Azure. In Part 1, I explain what AV1 is and where we are in the video encoding space. In part 2, we create a logic app to upload and index the video. In part 3, we&rsquo;ll need to split the video into its scenes and encode individual scenes. For reference, here are the links to all the parts:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/" />
<meta property="og:image" content="https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1.png" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2019-08-01T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-04-03T00:34:45-07:00" /><meta property="og:site_name" content="Kay&#39;s Blog" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1.png" />
<meta name="twitter:title" content="Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure"/>
<meta name="twitter:description" content="This is a 3-part blog covering how to build a scalable shot-based serverless video encoder in Azure. In Part 1, I explain what AV1 is and where we are in the video encoding space. In part 2, we create a logic app to upload and index the video. In part 3, we&rsquo;ll need to split the video into its scenes and encode individual scenes. For reference, here are the links to all the parts:"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://singhkays.com/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Part 2: Building a scalable 'shot-based' serverless AV1 video encoder in Azure",
      "item": "https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Part 2: Building a scalable 'shot-based' serverless AV1 video encoder in Azure",
  "name": "Part 2: Building a scalable \u0027shot-based\u0027 serverless AV1 video encoder in Azure",
  "description": "This is a 3-part blog covering how to build a scalable shot-based serverless video encoder in Azure. In Part 1, I explain what AV1 is and where we are in the video encoding space. In part 2, we create a logic app to upload and index the video. In part 3, we\u0026rsquo;ll need to split the video into its scenes and encode individual scenes. For reference, here are the links to all the parts:",
  "keywords": [
    "Azure", "Azure Functions", "Azure Logic Apps", "Azure Video Indexer", "Azure File Share", "Azure Storage", "Serverless", "AV1", "H.265", "H.264", "x264", "Video Codec", "Video Encoding"
  ],
  "articleBody": "This is a 3-part blog covering how to build a scalable shot-based serverless video encoder in Azure. In Part 1, I explain what AV1 is and where we are in the video encoding space. In part 2, we create a logic app to upload and index the video. In part 3, we’ll need to split the video into its scenes and encode individual scenes. For reference, here are the links to all the parts:\n https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-1/ https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/ https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-3/  The solution To implement this solution, we need an algorithm that splits the input video into shots. Fortunately for us, Microsoft Video Indexer supports this scenario. Before getting started we’ll setup Video Indexer in our subscription. For the rest of the steps, here’s a quick overview of what’s going to happen:\n User uploads an MP4 video file to Azure Blob Storage Because of the Azure Event Grid integration with Azure Blob Storage, a file upload event triggers a notification The event notification is consumed by the first Logic App. The first step in the Logic App is to upload the video to Microsoft Video Indexer service Once the video is indexed, we retrieve the video insights and store it in the “insights” Azure File share While the video indexing is happening, we also copy the video file from Azure Blob Storage to the “source” Azure File share where it can be accessed by container instances later When the indexing is complete, an “Indexing complete” notification is sent to trigger the second Logic App In the second Logic App, the first step is to retrieve the video insights saved earlier Next, we use an Azure Function to parse the shots data and create our container instance definitions as well as shots encoding commands for each container instance Now we can use the Logic App-Container Instance connector to create container instances based on container instance definitions defined in the last step As the container instances finish their respective encoding jobs, they save the output video in the “shots” Azure File share Next, we trigger another Azure Function to iterate over the output files and create a ffmpeg concat file Once we have a concat file, we create another container instance with ffmpeg installed to execute the concat file The output of the preview container instance i.e. all the encoded shots files that are combined to one file is saved in the “output” Azure File share The user can then download the encoded file from the “output” Azure File share  User Experience While building this solution, I wanted to keep the user experience simple. Hence a user needs to take only these steps:\n Upload an MP4 video file to a specified Azure Blob Storage Account Download the encoded file from the “output” Azure File share  Implementation Details Setup Microsoft Video Indexer   Start by going to https://vi.microsoft.com/en-us/ and logging in with your Azure account\n  Once logged in, click “Create new account”\n  Once you’ve logged into your Azure subscription, fill in the details for the Video Indexer instance you’d like to create.\n  It can take a few minutes for the Video Indexer to connect to your subscription. Once that is done, copy the account id of your new account\n  Now login with your Azure subscription at https://api-portal.videoindexer.ai/developer and copy the Primary or Secondary key\n  That’s it! Now Video Indexer instance is all setup in your subscription  Blob upload events   Create a storage account. I named mine “serverlessn codermedia”\n  In the storage account, create a container called “media” in the “Blobs” section. This is where the user will upload an .MP4 video file.\n  In the “Files” section, add 4 new file shares\na. insights – we’ll store the insights about indexed video hereb. output – we’ll store the full encoded video here that the user can downloadc. shots – we’ll store the individual encoded shots video files hered. source – we’ll store the user uploaded video file here for access by the container instances  Once the storage account is created, click the “Events” section of the storage account. In the “Events” section, use the “When a new blob is uploaded” quick start logic app to get started.  Next screen shows the Azure Blob Storage and Azure Event Grid connections   First create the connection for the storage account you just created   Next, sign into Azure Event Grid with your current Azure subscription. Once you’ve done these steps, you should see the following screen showing green status!\n  Hit continue and you should now land on the Logic Apps designer\n  In the “When a resource event occurs”a. select Event Type Item of Microsoft.Storage.BlobCreatedb. Add two new parameters – “Suffix Filter” with value \".mp4\" and “Subscription Name” with value anything you want  In the “If true” section g. Delete all steps except “Compose”\n   Your Logic App at this point should look like below\n  Save the logic app with whatever name you choose. In this solution, I named it as “video-indexer-logic-app”\n  Upload video to Microsoft Video Indexer   After the “Compose” action, add a “Create SAS URI by path” action\na. For the “Blob path”, choose the “Outputs” from the previous Compose action. You will have to click “See more” to see the output from the Compose action.b. Make sure you’re connected to the same Azure Blob Storage connection we defined earlier (storage-la-conn in this case)\n  Now add a “Get Account Access Token” action for Video Indexer (V2) connector.\na. The first time you do this, you will need to enter the Video Indexer API Key we copied earlier and enter a name for this Logic App-Video Indexer connectionb. Once the connection is created, select the location you deployed your Video Indexer instance to earlier.c. Select the account Id we saved earlierd. Select “Yes” for “Allow Edit”  Now add a “Upload video and index” step and fill in the following details as shows in the image.   For the Video Name field you can choose any name or make it dynamic using the expression tab to enter split(triggerBody()?[‘subject’], ‘/')?[6]. This splits the input video Uri to just the file name that was uploaded Copy user video to “source” Azure File share   Now we need to copy the source video file to the “source” Azure File share so that our encoding containers instances can access it. For that, add a “Create container group” action and configure it like shown below.\nWe’re using a small wget container that will download the video from the SAS Uri we generated earlier and then copy it to “source” Azure File Share. Note that we’re using a minimal docker image, therefore we’ll need to use “–no-check-certificate” with wget to download from HTTPS SAS Uri of Azure Blob Storage.\nNote that I’m creating this container in a new resource group “encoding-containers-rg” to keep a dedicated resource group for creating container instances.\nFor the containers field, you can use the following JSON to configure easily\n[ { \"name\":  output Video Id of “Upload and index” step, \"properties\": { \"image\": \"inutano/wget\", \"resources\": { \"requests\": { \"cpu\": 1, \"memoryInGB\": 0.5 } }, \"command\": [ \"wget\", \"--no-check-certificate\", \"-O\", \"/aci/source/\",  Web Url i.e. SAS Uri we generated earlier ], \"volumeMounts\": [ { \"mountPath\": \"/aci/source/\", \"name\": \"source\", \"readOnly\": false } ] } } ]   Next, add an “Until” action to check for the completion of the previous container instance. Before filling in the details of the “Until” action, add a “Delay” and “Get properties of a container group” action like below.\nOnce this is done, now you can fill in the details of the “Until” action like below. NOTE: there are a few different state variables that show up. Choose the one I highlighted in the image below. Also in the advanced mode make sure the value is following to make sure you’ve selected the correct variable\n@equals(body('Get_properties_of_a_container_group')?['properties']?['instanceView']?['state'], 'Succeeded')\n  Now for some cleanup! Let’s add a “Delete container group” action\n  First logic app created! At the end of above steps, your first logic app “video-indexer-logic-app” should look like below. I chose to leave the “If false” condition empty. You can setup an email notification for example if you choose to do so.\nEnd of Part 2 This is the end of Part 2. In Part 3, we’ll actually encode the shots and combine the shots into 1 video file.\n https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-3/  AV1 resources  AV1 Resource Central: Videos, Tools, Presentations, Comparisons, Research Papers, Encoders, Decoders It’s time to replace GIFs with AV1 video!  Contact Reach out if you have any questions! Feel free to follow me on\n Twitter - @singhkays LinkedIn - https://www.linkedin.com/in/singhkays/  ",
  "wordCount" : "1421",
  "inLanguage": "en",
  "image":"https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1.png","datePublished": "2019-08-01T00:00:00Z",
  "dateModified": "2021-04-03T00:34:45-07:00",
  "author":{
    "@type": "Person",
    "name": "Kay Singh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "KAY SINGH",
    "logo": {
      "@type": "ImageObject",
      "url": "https://singhkays.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://singhkays.com/" accesskey="h" title="Kay Singh (Alt + H)">
                <img src="/android-chrome-192x192.png" alt="logo" aria-label="logo"
                    height="35">Kay Singh</a>
            <span class="logo-switches">
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://singhkays.com/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://singhkays.com/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://singhkays.com/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://singhkays.com/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
            <li>
                <a href="https://singhkays.com/index.xml" title="RSS Feed">
                    <span>RSS Feed</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure
    </h1>
    <div class="post-meta">August 1, 2019&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Kay Singh
</div>
  </header> 
<figure class="entry-cover">
        <img loading="lazy" srcset="https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1_hu50128734b74bf29ac20ac761b6575f84_112807_360x0_resize_lanczos_2.png 360w ,https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1_hu50128734b74bf29ac20ac761b6575f84_112807_480x0_resize_lanczos_2.png 480w ,https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1_hu50128734b74bf29ac20ac761b6575f84_112807_720x0_resize_lanczos_2.png 720w ,https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1_hu50128734b74bf29ac20ac761b6575f84_112807_1080x0_resize_lanczos_2.png 1080w ,https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1_hu50128734b74bf29ac20ac761b6575f84_112807_1500x0_resize_lanczos_2.png 1500w ,https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1.png 2771w"
            sizes="(min-width: 768px) 720px, 100vw" src="https://singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/media/serverless-av1.png" alt="" />
        
</figure>
  <div class="post-content"><p>This is a 3-part blog covering how to build a scalable shot-based serverless video encoder in Azure. In Part 1, I explain what AV1 is and where we are in the video encoding space. In part 2, we create a logic app to upload and index the video. In part 3, we&rsquo;ll need to split the video into its scenes and encode individual scenes. For reference, here are the links to all the parts:</p>
<ol>
<li><a href="https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-1/">https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-1/</a></li>
<li><a href="https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/">https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-2/</a></li>
<li><a href="https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-3/">https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-3/</a></li>
</ol>
<h2 id="the-solution">The solution<a hidden class="anchor" aria-hidden="true" href="#the-solution">#</a></h2>
<p>To implement this solution, we need an algorithm that splits the input video into shots. Fortunately for us, <a href="https://vi.microsoft.com/en-us/">Microsoft Video Indexer</a> supports this scenario. Before getting started we&rsquo;ll setup Video Indexer in our subscription. For the rest of the steps, here&rsquo;s a quick overview of what&rsquo;s going to happen:</p>
<p><img loading="lazy" src="media/architecture.png" alt="&amp;ldquo;shot-based&amp;rdquo; serverless distributed AV1 video encoder in Azure"  />
</p>
<ol>
<li>User uploads an MP4 video file to Azure Blob Storage</li>
<li>Because of the Azure Event Grid integration with Azure Blob Storage, a file upload event triggers a notification</li>
<li>The event notification is consumed by the first Logic App. The first step in the Logic App is to upload the video to Microsoft Video Indexer service</li>
<li>Once the video is indexed, we retrieve the video insights and store it in the &ldquo;insights&rdquo; Azure File share</li>
<li>While the video indexing is happening, we also copy the video file from Azure Blob Storage to the &ldquo;source&rdquo; Azure File share where it can be accessed by container instances later</li>
<li>When the indexing is complete, an &ldquo;Indexing complete&rdquo; notification is sent to trigger the second Logic App</li>
<li>In the second Logic App, the first step is to retrieve the video insights saved earlier</li>
<li>Next, we use an Azure Function to parse the shots data and create our container instance definitions as well as shots encoding commands for each container instance</li>
<li>Now we can use the Logic App-Container Instance connector to create container instances based on container instance definitions defined in the last step</li>
<li>As the container instances finish their respective encoding jobs, they save the output video in the &ldquo;shots&rdquo; Azure File share</li>
<li>Next, we trigger another Azure Function to iterate over the output files and create a <a href="https://trac.ffmpeg.org/wiki/Concatenate#demuxer">ffmpeg concat file</a></li>
<li>Once we have a concat file, we create another container instance with ffmpeg installed to execute the concat file</li>
<li>The output of the preview container instance i.e. all the encoded shots files that are combined to one file is saved in the &ldquo;output&rdquo; Azure File share</li>
<li>The user can then download the encoded file from the &ldquo;output&rdquo; Azure File share</li>
</ol>
<h6 id="user-experience">User Experience<a hidden class="anchor" aria-hidden="true" href="#user-experience">#</a></h6>
<p>While building this solution, I wanted to keep the user experience simple. Hence a user needs to take only these steps:</p>
<ol>
<li>Upload an MP4 video file to a specified Azure Blob Storage Account</li>
<li>Download the encoded file from the &ldquo;output&rdquo; Azure File share</li>
</ol>
<h2 id="implementation-details">Implementation Details<a hidden class="anchor" aria-hidden="true" href="#implementation-details">#</a></h2>
<h6 id="setup-microsoft-video-indexer">Setup Microsoft Video Indexer<a hidden class="anchor" aria-hidden="true" href="#setup-microsoft-video-indexer">#</a></h6>
<ol>
<li>
<p>Start by going to <a href="https://vi.microsoft.com/en-us/">https://vi.microsoft.com/en-us/</a> and logging in with your Azure account</p>
</li>
<li>
<p>Once logged in, click &ldquo;Create new account&rdquo;</p>
<p><img loading="lazy" src="media/0-vi-account.png" alt="Azure Video indexer create account"  />
</p>
</li>
<li>
<p>Once you&rsquo;ve logged into your Azure subscription, fill in the details for the Video Indexer instance you&rsquo;d like to create.</p>
<p><img loading="lazy" src="media/0-vi-connect-azure.png" alt="Connect Azure Video Indexer to Azure subscription"  />
</p>
</li>
<li>
<p>It can take a few minutes for the Video Indexer to connect to your subscription. Once that is done, copy the account id of your new account</p>
<p><img loading="lazy" src="media/0-vi-account-id.png" alt="Azure Video Indexer account id"  />
</p>
</li>
<li>
<p>Now login with your Azure subscription at <a href="https://api-portal.videoindexer.ai/developer">https://api-portal.videoindexer.ai/developer</a> and copy the Primary or Secondary key</p>
</li>
</ol>
<!-- raw HTML omitted -->
<ol start="6">
<li>That&rsquo;s it! Now Video Indexer instance is all setup in your subscription</li>
</ol>
<h6 id="blob-upload-events">Blob upload events<a hidden class="anchor" aria-hidden="true" href="#blob-upload-events">#</a></h6>
<ol>
<li>
<p>Create a storage account. I named mine <strong>&ldquo;serverlessn codermedia&rdquo;</strong></p>
</li>
<li>
<p>In the storage account, create a container called <strong>&ldquo;media&rdquo;</strong> in the <strong>&ldquo;Blobs&rdquo;</strong> section. This is where the user will upload an .MP4 video file.</p>
</li>
<li>
<p>In the <strong>&ldquo;Files&rdquo;</strong> section, add 4 new file shares</p>
<p><strong>a.</strong>  <strong>insights</strong> &ndash; we&rsquo;ll store the insights about indexed video here<!-- raw HTML omitted -->
<strong>b.</strong>  <strong>output</strong> &ndash; we&rsquo;ll store the full encoded video here that the user can download<!-- raw HTML omitted -->
<strong>c.</strong>  <strong>shots</strong> &ndash; we&rsquo;ll store the individual encoded shots video files here<!-- raw HTML omitted -->
<strong>d.</strong>  <strong>source</strong> &ndash; we&rsquo;ll store the user uploaded video file here for access by the container instances<!-- raw HTML omitted --></p>
<p><img loading="lazy" src="media/storage-account-event-grid-subscription-1.8.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
<li>
<p>Once the storage account is created, click the <strong>&ldquo;Events&rdquo;</strong> section of the storage account. In the <strong>&ldquo;Events&rdquo;</strong> section, use the <strong>&ldquo;When a new blob is uploaded&rdquo;</strong> quick start logic app to get started.<!-- raw HTML omitted --><br>
<img loading="lazy" src="media/storage-account-event-grid-subscription.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
<li>
<p>Next screen shows the Azure Blob Storage and Azure Event Grid connections <!-- raw HTML omitted -->
<img loading="lazy" src="media/storage-account-event-grid-subscription-1.5.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
<li>
<p>First create the connection for the storage account you just created
<img loading="lazy" src="media/storage-account-event-grid-subscription-1.6.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
<li>
<p>Next, sign into Azure Event Grid with your current Azure subscription. Once you&rsquo;ve done these steps, you should see the following screen showing green status!</p>
<p><img loading="lazy" src="media/storage-account-event-grid-subscription-1.7.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
<li>
<p>Hit continue and you should now land on the Logic Apps designer</p>
</li>
<li>
<p>In the <strong>&ldquo;When a resource event occurs&rdquo;</strong><!-- raw HTML omitted -->
<strong>a.</strong>  select <strong>Event Type</strong> Item of <code>Microsoft.Storage.BlobCreated</code><!-- raw HTML omitted -->
<strong>b.</strong>  Add two new parameters &ndash; <strong>&ldquo;Suffix Filter&rdquo;</strong> with value <strong>&quot;.mp4&quot;</strong> and <strong>&ldquo;Subscription Name&rdquo;</strong> with value anything you want<!-- raw HTML omitted --></p>
</li>
<li>
<p>In the <strong>&ldquo;If true&rdquo;</strong> section
g.  Delete all steps except <strong>&ldquo;Compose&rdquo;</strong></p>
</li>
</ol>
<!-- raw HTML omitted -->
<ol start="11">
<li>
<p>Your Logic App at this point should look like below</p>
<p><img loading="lazy" src="media/storage-account-event-grid-subscription-2.png" alt="A screenshot of a social media post Description automatically generated"  />
</p>
</li>
<li>
<p>Save the logic app with whatever name you choose. In this solution, I named it as <strong>&ldquo;video-indexer-logic-app&rdquo;</strong></p>
</li>
</ol>
<h6 id="upload-video-to-microsoft-video-indexer">Upload video to Microsoft Video Indexer<a hidden class="anchor" aria-hidden="true" href="#upload-video-to-microsoft-video-indexer">#</a></h6>
<ol>
<li>
<p>After the <strong>&ldquo;Compose&rdquo;</strong> action, add a <strong>&ldquo;Create SAS URI by path&rdquo;</strong> action</p>
<p><strong>a.</strong> For the <strong>&ldquo;Blob path&rdquo;</strong>, choose the <strong>&ldquo;Outputs&rdquo;</strong> from the previous Compose action. You will have to click <strong>&ldquo;See more&rdquo;</strong> to see the output from the Compose action.<!-- raw HTML omitted -->
<strong>b.</strong> Make sure you&rsquo;re connected to the same Azure Blob Storage connection we defined earlier <em>(storage-la-conn in this case)</em></p>
<p><img loading="lazy" src="media/2-create-sas-uri.png" alt="A screenshot of a social media post Description automatically generated"  />
</p>
</li>
<li>
<p>Now add a <strong>&ldquo;Get Account Access Token&rdquo;</strong> action for Video Indexer (V2) connector.</p>
<p><img loading="lazy" src="media/3-vi-get-account-access-token.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
<p><strong>a.</strong> The first time you do this, you will need to enter the <strong>Video Indexer API Key</strong> we copied earlier and enter a name for this Logic App-Video Indexer connection<!-- raw HTML omitted -->
<img loading="lazy" src="media/4-vi-create-connection.png" alt="A screenshot of a cell phone Description automatically generated"  />
<!-- raw HTML omitted -->
<strong>b.</strong> Once the connection is created, select the <strong>location</strong> you deployed your Video Indexer instance to earlier.<!-- raw HTML omitted -->
<strong>c.</strong> Select the <strong>account Id</strong> we saved earlier<!-- raw HTML omitted -->
<strong>d.</strong> Select <strong>&ldquo;Yes&rdquo;</strong> for <strong>&ldquo;Allow Edit&rdquo;</strong><!-- raw HTML omitted --></p>
<p><img loading="lazy" src="media/5-vi-get-account-access-token-details.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
<li>
<p>Now add a <strong>&ldquo;Upload video and index&rdquo;</strong> step and fill in the following details as shows in the image.
<img loading="lazy" src="media/6-vi-upload-video-index.png" alt="A screenshot of a social media post Description automatically generated"  />
</p>
</li>
</ol>
<p>For the Video Name field you can choose any name or make it dynamic using the expression tab to enter split(triggerBody()?[&lsquo;subject&rsquo;], &lsquo;/')?[6]. This splits the input video Uri to just the file name that was uploaded
<img loading="lazy" src="media/6.1-vi-upload-video-index.png" alt="A screenshot of a social media post Description automatically generated"  />
</p>
<h6 id="copy-user-video-to-source-azure-file-share">Copy user video to &ldquo;source&rdquo; Azure File share<a hidden class="anchor" aria-hidden="true" href="#copy-user-video-to-source-azure-file-share">#</a></h6>
<ol>
<li>
<p>Now we need to copy the source video file to the <strong>&ldquo;source&rdquo;</strong> Azure File share so that our encoding containers instances can access it. For that, add a <strong>&ldquo;Create container group&rdquo;</strong> action and configure it like shown below.</p>
<p>We&rsquo;re using a small wget container that will download the video from the SAS Uri we generated earlier and then copy it to <strong>&ldquo;source&rdquo;</strong> Azure File Share. Note that we&rsquo;re using a minimal docker image, therefore we&rsquo;ll need to use &ldquo;&ndash;no-check-certificate&rdquo; with wget to download from HTTPS SAS Uri of Azure Blob Storage.</p>
<p>Note that I&rsquo;m creating this container in a new resource group <strong>&ldquo;encoding-containers-rg&rdquo;</strong> to keep a dedicated resource group for creating container instances.</p>
<p><img loading="lazy" src="media/7-create-container-group.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
<p>For the containers field, you can use the following JSON to configure easily</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
    {
        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#960050;background-color:#1e0010">&lt;select</span> <span style="color:#960050;background-color:#1e0010">output</span> <span style="color:#960050;background-color:#1e0010">Video</span> <span style="color:#960050;background-color:#1e0010">Id</span> <span style="color:#960050;background-color:#1e0010">of</span> <span style="color:#960050;background-color:#1e0010">“Upload</span> <span style="color:#960050;background-color:#1e0010">and</span> <span style="color:#960050;background-color:#1e0010">index”</span> <span style="color:#960050;background-color:#1e0010">step</span>,
        <span style="color:#f92672">&#34;properties&#34;</span>: {
            <span style="color:#f92672">&#34;image&#34;</span>: <span style="color:#e6db74">&#34;inutano/wget&#34;</span>,
            <span style="color:#f92672">&#34;resources&#34;</span>: {
                <span style="color:#f92672">&#34;requests&#34;</span>: {
                    <span style="color:#f92672">&#34;cpu&#34;</span>: <span style="color:#ae81ff">1</span>,
                    <span style="color:#f92672">&#34;memoryInGB&#34;</span>: <span style="color:#ae81ff">0.5</span>
                }
            },
            <span style="color:#f92672">&#34;command&#34;</span>: [
                <span style="color:#e6db74">&#34;wget&#34;</span>,
                <span style="color:#e6db74">&#34;--no-check-certificate&#34;</span>,
                <span style="color:#e6db74">&#34;-O&#34;</span>,
                <span style="color:#e6db74">&#34;/aci/source/&lt; enter into expression tab split(triggerBody()?[&#39;subject&#39;], &#39;/&#39;)?[6] &gt;&#34;</span>,
                    <span style="color:#960050;background-color:#1e0010">&lt;Insert</span> <span style="color:#960050;background-color:#1e0010">Web</span> <span style="color:#960050;background-color:#1e0010">Url</span> <span style="color:#960050;background-color:#1e0010">i.e.</span> <span style="color:#960050;background-color:#1e0010">SAS</span> <span style="color:#960050;background-color:#1e0010">Uri</span> <span style="color:#960050;background-color:#1e0010">we</span> <span style="color:#960050;background-color:#1e0010">generated</span> <span style="color:#960050;background-color:#1e0010">earlier&gt;</span>
            ],
            <span style="color:#f92672">&#34;volumeMounts&#34;</span>: [
                {
                    <span style="color:#f92672">&#34;mountPath&#34;</span>: <span style="color:#e6db74">&#34;/aci/source/&#34;</span>,
                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;source&#34;</span>,
                    <span style="color:#f92672">&#34;readOnly&#34;</span>: <span style="color:#66d9ef">false</span>
                }
            ]
        }
    }
]
</code></pre></div><p><!-- raw HTML omitted --></p>
</li>
<li>
<p>Next, add an <strong>&ldquo;Until&rdquo;</strong> action to check for the completion of the previous container instance. Before filling in the details of the <strong>&ldquo;Until&rdquo;</strong> action, add a <strong>&ldquo;Delay&rdquo;</strong> and <strong>&ldquo;Get properties of a container group&rdquo;</strong> action like below.</p>
<p><img loading="lazy" src="media/8.1-until.png" alt="A screenshot of a computer Description automatically generated"  />
</p>
<p>Once this is done, now you can fill in the details of the <strong>&ldquo;Until&rdquo;</strong> action like below. NOTE: there are a few different state variables that show up. Choose the one I highlighted in the image below. Also in the advanced mode make sure the value is following to make sure you&rsquo;ve selected the correct variable</p>
<p><code>@equals(body('Get_properties_of_a_container_group')?['properties']?['instanceView']?['state'], 'Succeeded')</code></p>
<p><img loading="lazy" src="media/8.2-until.png" alt="A screenshot of a computer Description automatically generated"  />
</p>
<!-- raw HTML omitted -->
</li>
<li>
<p>Now for some cleanup! Let&rsquo;s add a <strong>&ldquo;Delete container group&rdquo;</strong> action</p>
<p><img loading="lazy" src="media/9-delete-container.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
</li>
</ol>
<h2 id="first-logic-app-created">First logic app created!<a hidden class="anchor" aria-hidden="true" href="#first-logic-app-created">#</a></h2>
<p>At the end of above steps, your first logic app <strong>&ldquo;video-indexer-logic-app&rdquo;</strong> should look like below. I chose to leave the <strong>&ldquo;If false&rdquo;</strong> condition empty. You can setup an email notification for example if you choose to do so.</p>
<!-- raw HTML omitted -->
<p><img loading="lazy" src="media/10-logic-app-1-complete.png" alt="A screenshot of a cell phone Description automatically generated"  />
</p>
<h2 id="end-of-part-2">End of Part 2<a hidden class="anchor" aria-hidden="true" href="#end-of-part-2">#</a></h2>
<p>This is the end of Part 2. In Part 3, we&rsquo;ll actually encode the shots and combine the shots into 1 video file.</p>
<ul>
<li><a href="https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-3/">https://www.singhkays.com/blog/azure-serverless-distributed-video-encoder-av1-part-3/</a></li>
</ul>
<h2 id="av1-resources">AV1 resources<a hidden class="anchor" aria-hidden="true" href="#av1-resources">#</a></h2>
<ul>
<li><a href="https://www.singhkays.com/blog/av1-wiki-resources-tools/">AV1 Resource Central: Videos, Tools, Presentations, Comparisons, Research Papers, Encoders, Decoders</a></li>
<li><a href="https://www.singhkays.com/blog/its-time-replace-gifs-with-av1-video/">It&rsquo;s time to replace GIFs with AV1 video!</a></li>
</ul>
<h2 id="contact">Contact<a hidden class="anchor" aria-hidden="true" href="#contact">#</a></h2>
<p>Reach out if you have any questions! Feel free to follow me on</p>
<ul>
<li>Twitter - <a href="https://twitter.com/singhkays">@singhkays</a></li>
<li>LinkedIn - <a href="https://www.linkedin.com/in/singhkays/">https://www.linkedin.com/in/singhkays/</a></li>
</ul>

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://singhkays.com/tags/azure/">Azure</a></li>
      <li><a href="https://singhkays.com/tags/azure-functions/">Azure Functions</a></li>
      <li><a href="https://singhkays.com/tags/azure-logic-apps/">Azure Logic Apps</a></li>
      <li><a href="https://singhkays.com/tags/azure-video-indexer/">Azure Video Indexer</a></li>
      <li><a href="https://singhkays.com/tags/azure-file-share/">Azure File Share</a></li>
      <li><a href="https://singhkays.com/tags/azure-storage/">Azure Storage</a></li>
      <li><a href="https://singhkays.com/tags/serverless/">Serverless</a></li>
      <li><a href="https://singhkays.com/tags/av1/">AV1</a></li>
      <li><a href="https://singhkays.com/tags/h.265/">H.265</a></li>
      <li><a href="https://singhkays.com/tags/h.264/">H.264</a></li>
      <li><a href="https://singhkays.com/tags/x264/">x264</a></li>
      <li><a href="https://singhkays.com/tags/video-codec/">Video Codec</a></li>
      <li><a href="https://singhkays.com/tags/video-encoding/">Video Encoding</a></li>
    </ul>
    <nav class="paginav">
      <a class="prev" href="https://singhkays.com/blog/av1-ecosystem-update-july-2019/">
        <span class="title">« Prev Page</span>
        <br>
        <span>AV1 Ecosystem Update: July 2019</span>
      </a>
      <a class="next" href="https://singhkays.com/blog/av1-ecosystem-update-june-2019/">
        <span class="title">Next Page »</span>
        <br>
        <span>AV1 Ecosystem Update: June 2019</span>
      </a>
    </nav>
<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure on twitter"
        href="https://twitter.com/intent/tweet/?text=Part%202%3a%20Building%20a%20scalable%20%27shot-based%27%20serverless%20AV1%20video%20encoder%20in%20Azure&amp;url=https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f&amp;hashtags=Azure%2cAzureFunctions%2cAzureLogicApps%2cAzureVideoIndexer%2cAzureFileShare%2cAzureStorage%2cServerless%2cAV1%2cH.265%2cH.264%2cx264%2cVideoCodec%2cVideoEncoding">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f&amp;title=Part%202%3a%20Building%20a%20scalable%20%27shot-based%27%20serverless%20AV1%20video%20encoder%20in%20Azure&amp;summary=Part%202%3a%20Building%20a%20scalable%20%27shot-based%27%20serverless%20AV1%20video%20encoder%20in%20Azure&amp;source=https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f&title=Part%202%3a%20Building%20a%20scalable%20%27shot-based%27%20serverless%20AV1%20video%20encoder%20in%20Azure">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure on whatsapp"
        href="https://api.whatsapp.com/send?text=Part%202%3a%20Building%20a%20scalable%20%27shot-based%27%20serverless%20AV1%20video%20encoder%20in%20Azure%20-%20https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Part 2: Building a scalable &#39;shot-based&#39; serverless AV1 video encoder in Azure on telegram"
        href="https://telegram.me/share/url?text=Part%202%3a%20Building%20a%20scalable%20%27shot-based%27%20serverless%20AV1%20video%20encoder%20in%20Azure&amp;url=https%3a%2f%2fsinghkays.com%2fblog%2fazure-serverless-distributed-video-encoder-av1-part-2%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    <footer class="footer">
    <span>Copyright © 2017–2021, Kay Singh; all rights reserved.</span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "50f40f74d1b240c398f1be6760b6e964"}'></script>

<script defer src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>

<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
